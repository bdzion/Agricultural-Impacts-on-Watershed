import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import os

# Define the file path and output directory
file_path = r"C:\Users\mbodrudd\OneDrive - University of Guelph\Zion\Zion PhD study\ABCA\ZionAnalysis\NewAnalysisAug\FinalAnalysisAug20\FinalCalculatedData\Imputed_MonthlyRecalculatedData.csv"
output_dir = r"C:\Users\mbodrudd\OneDrive - University of Guelph\Zion\Zion PhD study\ABCA\ZionAnalysis\NewAnalysisAug\FinalAnalysisAug20\FinalCalculatedData\Plots"

# Create the output directory if it doesn't exist
os.makedirs(output_dir, exist_ok=True)

# Load the CSV file
data = pd.read_csv(file_path)

# Convert 'Year_Month' to datetime and extract month
data['Year_Month'] = pd.to_datetime(data['Year_Month'], format='%Y-%m')
data['Month'] = data['Year_Month'].dt.month

# Define plotting function
def plot_and_save_boxplots(data, columns, title, filename):
    plt.figure(figsize=(20, len(columns) * 3))  # Adjust figure size appropriately
    sns.set(style="whitegrid")  # Set the aesthetic style of the plots
    for i, col in enumerate(columns):
        plt.subplot(len(columns), 1, i + 1)  # Create a subplot for each variable
        sns.boxplot(x='Month', y=col, data=data, hue='Month', palette='viridis', dodge=False)
        plt.title(f'{col} Monthly Variation')
        plt.xlabel('Month')
        plt.ylabel(col)
        plt.legend([],[], frameon=False)  # Disable the legend as it is not necessary
    plt.tight_layout()
    plt.suptitle(title, fontsize=16, y=1.02)
    plt.savefig(os.path.join(output_dir, filename), bbox_inches='tight')
    plt.close()  # Close the figure to free up memory

# Call the function for each category
plot_and_save_boxplots(data, 
                       ['Total_Mass_Load_NO3_kg', 'Total_Mass_Load_TKN_kg', 'Total_Mass_Load_TN_kg',
                        'Total_Mass_Load_DRP_kg', 'Total_Mass_Load_TP_kg', 'Total_Mass_Load_TSS_kg'],
                       'Total Mass Load (kg) Monthly Variation',
                       'Total_Mass_Load_Monthly_Variation.png')

plot_and_save_boxplots(data, 
                       ['FWMC_NO3_mg_L', 'FWMC_TKN_mg_L', 'FWMC_TN_mg_L', 
                        'FWMC_DRP_mg_L', 'FWMC_TP_mg_L', 'FWMC_TSS_mg_L'],
                       'Flow-Weighted Mean Concentration (mg/L) Monthly Variation',
                       'FWMC_Monthly_Variation.png')

plot_and_save_boxplots(data, 
                       ['Mass_Export_NO3_kg_ha', 'Mass_Export_TKN_kg_ha', 'Mass_Export_TN_kg_ha', 
                        'Mass_Export_DRP_kg_ha', 'Mass_Export_TP_kg_ha', 'Mass_Export_TSS_kg_ha'],
                       'Mass Export (kg/ha) Monthly Variation',
                       'Mass_Export_Monthly_Variation.png')

plot_and_save_boxplots(data, 
                       ['Total_MeasuredFlow_CMS', 'Total_BaseFlow_CMS', 'Total_StreamFlow_CMS', 
                        'TotalWaterVolume_m3', 'TotalRunoff_mm', 'MonthlyTotalPrecipitation_mm'],
                       'Hydrological Measurements Monthly Variation',
                       'Hydrological_Measurements_Monthly_Variation.png')
